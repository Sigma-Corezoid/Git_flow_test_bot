{"obj_type":1,"obj_id":1011998,"parent_id":424848,"title":"Send Message","description":"","status":"active","params":[{"name":"attachment_id","type":"string","descr":"attachment ID","flags":["input"],"regex":"","regex_error_text":""},{"name":"channel","type":"string","descr":"channel","flags":["input","required"],"regex":"","regex_error_text":""},{"name":"chat_id","type":"string","descr":"chat_id","flags":["input","required"],"regex":"","regex_error_text":""},{"name":"settings","type":"string","descr":"extra settings","flags":[],"regex":"","regex_error_text":""},{"name":"text_id","type":"string","descr":"text ID from \"Config/Texts\" state diagram","flags":["input"],"regex":"","regex_error_text":""}],"ref_mask":true,"conv_type":"process","scheme":{"nodes":[{"id":"61adf4a782ba9651b2f90286","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f785e9","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90118","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a782ba9651b2f90118"}],"semaphors":[]},"title":"","description":"","x":720,"y":972,"uuid":"0b55e47b-8b92-4fec-bcc9-7149f37daff0","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90288","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a7513aa03475f7846a","chTime":1543587897002}]},"title":"","description":"","x":720,"y":728,"uuid":"7f6ef65d-0f50-402c-b7da-eabfd9fc9884","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f785ea","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":1312,"y":1044,"uuid":"a4441f62-15c5-49c8-a66a-a2fe5929c6c8","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f9010c","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":-448,"y":-960,"uuid":"27e5afba-7886-4ebb-a1e8-2e5de4c5022d","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f9010e","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a782ba9651b2f9011b"}]},"title":"","description":"","x":1212,"y":1112,"uuid":"5e2cf253-dde1-4279-91f0-4962156ffdaa","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7846f","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":828,"y":1184,"uuid":"45c26e98-f69b-4a6a-9993-2e511cb1cc79","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f90116","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":1316,"y":868,"uuid":"6d412497-bdbf-46f3-8da4-0bc31381515a","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f9011a","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":660,"y":-369,"uuid":"24301312-7d44-4ce3-a696-0d98d51ac763","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f9010b","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"Final","description":"","x":352,"y":1208,"uuid":"42522f71-1b0b-4aa3-8cee-c1cf8f9207ea","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f90110","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90111","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78471","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f78471"}],"semaphors":[]},"title":"","description":"","x":632,"y":252,"uuid":"7914a8d1-b303-4e8e-bff1-e4e3848703f0","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f785eb","obj_type":0,"condition":{"logics":[{"type":"api_rpc","err_node_id":"61adf4a7513aa03475f78473","conv_id":1012021,"extra":{"chat_id":"{{chat_id}}","text":"{{text}}","keyboard":"{{keyboard}}","rich_media":"{{rich_media}}","media":"{{media}}","size":"{{size}}","type":"{{attachment.type}}","file_name":"{{file_name}}"},"extra_type":{"chat_id":"string","text":"string","keyboard":"object","rich_media":"object","media":"string","size":"string","type":"string","file_name":"string"},"user_id":76110,"convTitle":"sendMessage","chTime":1554800683427},{"type":"go","to_node_id":"61adf4a8513aa03475f7869e","chTime":1514362046069}],"semaphors":[]},"title":"Viber","description":"","x":988,"y":584,"uuid":"768d2cbe-f9c4-4ee4-a1c5-b5e257f90123","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78474","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":1316,"y":692,"uuid":"92369368-1b88-4af7-8550-e94effb4bf47","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f785e7","obj_type":0,"condition":{"logics":[{"type":"api_rpc_reply","res_data":{"result":"{{result}}"},"res_data_type":{"result":"string"},"mode":"key_value","throw_exception":false},{"type":"go","to_node_id":"61adf4a7513aa03475f78477","chTime":1514361778067}],"semaphors":[]},"title":"Success","description":"","x":1588,"y":980,"uuid":"7c77a1bf-324d-477c-aa7e-a175c81feb67","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7846e","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a882ba9651b2f9033f","chTime":1543587897002}]},"title":"","description":"","x":720,"y":1080,"uuid":"ae5efff3-b4f3-40a6-9dc1-fddba7a97679","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90282","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":316,"y":-616,"uuid":"23e7393a-2c93-4a94-bf3a-ebe42ddfaf37","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f90283","obj_type":1,"condition":{"logics":[{"type":"go","to_node_id":"61adf4a882ba9651b2f903f2","chTime":1522788235535}],"semaphors":[]},"title":"start","description":"","x":-292,"y":-1144,"uuid":"af98f51b-f6a0-44dd-8441-307685092db8","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f7869a","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"attachment":"{}"},"err_node_id":"61adf4a8513aa03475f78729","extra_type":{"attachment":"object"}},{"type":"go","to_node_id":"61adf4a782ba9651b2f9010d","chTime":1523863929072}],"semaphors":[]},"title":"SET default attachment","description":"","x":-220,"y":4,"uuid":"a6564900-5ab7-4396-af75-17ffcdaf014e","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f785e5","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f9010e","conditions":[{"fun":"eq","const":"crash_api","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f9010e","conditions":[{"fun":"eq","const":"rpc_task_fatal_error","param":"__conveyor_rpc_return_type_tag__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a8513aa03475f786f8","conditions":[{"fun":"eq","const":"access_denied","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a8513aa03475f786f8","conditions":[{"fun":"eq","const":"rpc_reply_exception","param":"__conveyor_rpc_reply_return_type_tag__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a8513aa03475f786f8"}],"semaphors":[]},"title":"","description":"","x":1212,"y":1188,"uuid":"b1312edc-afe2-45ab-8440-dc5b68f4711f","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f7869b","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a7513aa03475f7846c","type":"go_if_const","conditions":[{"param":"attachment_id","const":"","fun":"not_eq","cast":"string"}],"chTime":1513152175290},{"type":"go","to_node_id":"61adf4a7513aa03475f7846d","chTime":1513868909644}],"semaphors":[]},"title":"Check attachments","description":"","x":72,"y":-324,"uuid":"db6700af-9126-44ae-9364-cd52cebff8c3","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f786f8","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":1320,"y":1216,"uuid":"7212a572-6177-47b0-91bb-3740dd02d6cc","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f785e6","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"language":"en"},"err_node_id":"61adf4a7513aa03475f78478","extra_type":{"language":"string"},"chTime":1518597566690},{"type":"go","to_node_id":"61adf4a8513aa03475f78728","chTime":1522680411895}],"semaphors":[]},"title":"SET default language == EN","description":"","x":72,"y":-860,"uuid":"6f115300-b76a-4c45-b12a-4a651d6e3c77","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90285","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"text":"{{localization.{{text_id}}.{{language}}}}"},"err_node_id":"61adf4a782ba9651b2f9011a","extra_type":{"text":"string"},"chTime":1513152158373},{"type":"go","to_node_id":"61adf4a8513aa03475f7869b","chTime":1518537548353}],"semaphors":[]},"title":"GET localized text by text_id","description":"","x":408,"y":-460,"uuid":"81dc0373-4b42-41b0-9d9e-60398025667d","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90287","obj_type":0,"condition":{"logics":[{"type":"api_rpc","err_node_id":"61adf4a782ba9651b2f90115","conv_id":1012014,"extra":{"chat_id":"{{chat_id}}","text":"{{text}}","reply_markup":"{{reply_markup}}","parse_mode":"{{parse_mode}}","url":"{{url}}","type":"{{attachment.type}}"},"extra_type":{"chat_id":"string","text":"string","reply_markup":"object","parse_mode":"string","url":"string","type":"string"},"user_id":76110,"convTitle":"sendMessage","chTime":1554800699285},{"type":"go","to_node_id":"61adf4a8513aa03475f7869e","chTime":1514361711354}],"semaphors":[]},"title":"Telegram","description":"","x":988,"y":760,"uuid":"a661e629-fbb9-4fbd-b4e6-5f045d5a5b46","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f7873e","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a882ba9651b2f9039c","chTime":1554800710798}]},"title":"","description":"","x":1212,"y":936,"uuid":"edf5cd6e-5674-470f-8200-b8ae715b8b24","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f78729","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":-264,"y":96,"uuid":"6e6442ec-616d-4a03-add1-9cecf640e276","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f785e8","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a7513aa03475f785eb","chTime":1554800683440}]},"title":"","description":"","x":1212,"y":584,"uuid":"559df9d2-3df5-46e8-af51-4f8f4ce4ef95","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f785e9","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a882ba9651b2f9039e","chTime":1543587897002}]},"title":"","description":"","x":720,"y":896,"uuid":"b43e792e-d2cd-4658-864d-1b1634e1af0f","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a882ba9651b2f9039d","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a782ba9651b2f9011d","chTime":1543587890449}]},"title":"","description":"","x":720,"y":556,"uuid":"927b9a71-5e30-4f6f-95cd-7ef91a070fbc","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f7869f","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a782ba9651b2f9010d","chTime":1542902879227}]},"title":"","description":"","x":292,"y":400,"uuid":"6d57e4b0-7a26-4834-a78c-4392a7f529e0","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90289","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"Undefined channel","description":"","x":172,"y":1052,"uuid":"842acb08-5aab-42a5-ab38-0fd3405324a4","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a882ba9651b2f90341","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":656,"y":-153,"uuid":"04aa4d52-cb80-444f-82fa-0bbcbed4dce4","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a882ba9651b2f9039e","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a782ba9651b2f90286","src":"if (data.attachment.raw) {\n    for (var key in data.attachment)\n        data[key] = data.attachment[key];\n    if (!data.reply_markup) data.reply_markup = {};\n} else GetTelegramAttachment(data.attachment);\n\nfunction GetTelegramAttachment(obj) {\n    switch (obj.type) {\n        case \"buttons\":\n            data.message = {\n                \"attachment\": {\n                    \"payload\": {\n                        \"buttons\": data.attachment.buttons,\n                        \"template_type\": \"button\",\n                        \"text\": data.text\n                    },\n                    \"type\": \"template\"\n                }\n            };\n            break;\n        case \"quick_replies\":\n            data.message = {\n                \"text\": data.text,\n                \"quick_replies\": data.attachment.buttons\n            };\n            break;\n        case \"carousel\":\n            data.message = {\n                \"attachment\": {\n                    \"type\": \"template\",\n                    \"payload\": {\n                        \"template_type\": \"generic\",\n                        \"elements\": data.attachment.items\n                    }\n                }\n            };\n            break;\n        case \"carousel_with_keyboard\":\n            data.message = {\n                \"quick_replies\": data.attachment.buttons,\n                \"attachment\": {\n                    \"type\": \"template\",\n                    \"payload\": {\n                        \"template_type\": \"generic\",\n                        \"elements\": data.attachment.items\n                    }\n                }\n            };\n            break;\n        case \"list\":\n            data.message = {\n                \"attachment\": data.attachment.items\n            };\n            break;\n        case \"invoice\":\n            data.message = {\n                \"attachment\": {\n                    \"type\": \"template\",\n                    \"payload\": data.attachment\n                }\n            };\n            break;\n        case \"image\":\n        case \"video\":\n        case \"audio\":\n        case \"file\":    \n            data.message = {\n                \"attachment\": {\n                    \"type\": data.attachment.type,\n                    \"payload\": {\n                        \"url\": data.attachment.url,\n                        \"is_reusable\": true\n                    }\n                }\n            };\n            break;\n        default:\n            data.message = {\n                \"text\": data.text\n            };\n            break;\n    }\n\n}","lang":"js"},{"type":"go","to_node_id":"61adf4a882ba9651b2f9039c","chTime":1543588149689}],"semaphors":[]},"title":"Facebook Native Syntax","description":"","x":500,"y":896,"uuid":"5aac0e62-7457-44ee-aa2b-361df6be1ddb","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78471","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":736,"y":280,"uuid":"a4f825c2-24d7-48c2-98e5-3138fcea34d5","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a782ba9651b2f90111","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a7513aa03475f7846b","chTime":1543587877201}]},"title":"","description":"","x":632,"y":176,"uuid":"75ad7a10-bc9c-4805-ab11-99f0d3a4866e","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90118","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":828,"y":1000,"uuid":"2f71c26b-e002-480a-abb2-850e1e58da42","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f78479","obj_type":0,"condition":{"logics":[],"semaphors":[{"type":"time","value":30,"dimension":"sec","to_node_id":"61adf4a782ba9651b2f90287","chTime":1554800699299}]},"title":"","description":"","x":1212,"y":760,"uuid":"628a79b6-ce43-4f86-b7df-2d257a4aad31","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78475","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":820,"y":660,"uuid":"d5a1e9ab-fbad-4744-9d2d-0ef498ddbaa6","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f78477","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"Success","description":"","x":1688,"y":1180,"uuid":"5f14a5ca-ade1-4785-8287-852c999080ac","extra":"{\"modeForm\":\"collapse\",\"icon\":\"success\"}","options":null},{"id":"61adf4a782ba9651b2f90117","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"Error","description":"","x":1992,"y":988,"uuid":"48bf5272-74f7-45a4-9e9b-2b7d49c1e39b","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f78478","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":312,"y":-768,"uuid":"b37ece98-2fbc-48ce-a257-75c6361c5a5d","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f7846a","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a782ba9651b2f90113","src":"if (data.attachment.raw) {\n    for (var key in data.attachment)\n        data[key] = data.attachment[key];\n    if (!data.reply_markup) data.reply_markup = {};\n} else GetTelegramAttachment(data.attachment);\n\nfunction GetTelegramAttachment(obj) {\n    switch (obj.type) {\n        case \"inline_keyboard\":\n            data.reply_markup = {\n                \"inline_keyboard\": data.attachment.buttons\n            };\n            if (data.attachment.parse_mode) data.parse_mode = data.attachment.parse_mode;\n            else data.parse_mode = \"HTML\";\n            break;\n        case \"keyboard\":\n            data.reply_markup = {\n                \"keyboard\": data.attachment.buttons,\n                \"one_time_keyboard\": true,\n                \"resize_keyboard\": true\n            };\n            if (data.attachment.parse_mode) data.parse_mode = data.attachment.parse_mode;\n            else data.parse_mode = \"HTML\";\n            break;\n        case \"image\":\n        case \"video\":\n        case \"audio\":\n            data.url = data.attachment.url;\n            if (data.attachment.caption) data.text = data.attachment.caption;\n            data.reply_markup = {};\n            break;\n        case \"location\":\n            data.lat = data.attachment.lat;\n            data.lon = data.attachment.lon;\n            data.reply_markup = {};\n            break;\n        default:\n            data.reply_markup = {};\n            break;\n    }\n\n}","lang":"js"},{"type":"go","to_node_id":"61adf4a782ba9651b2f90287","chTime":1543502589558}],"semaphors":[]},"title":"Telegram Native Syntax","description":"","x":500,"y":728,"uuid":"05d872f2-0bd5-45eb-a029-ffe10d826415","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90119","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":392,"y":504,"uuid":"7168942a-abd6-4914-96fb-620f50c28506","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a7513aa03475f78476","obj_type":2,"condition":{"logics":[],"semaphors":[]},"title":"","description":"","x":820,"y":832,"uuid":"8c86fb28-3ec7-47e2-ad2d-7723afe2e692","extra":"{\"modeForm\":\"collapse\",\"icon\":\"error\"}","options":null},{"id":"61adf4a882ba9651b2f9039c","obj_type":0,"condition":{"logics":[{"type":"api_rpc","err_node_id":"61adf4a882ba9651b2f90340","conv_id":1012039,"extra":{"chat_id":"{{chat_id}}","text":"{{text}}","message":"{{message}}","type":"{{attachment.type}}"},"extra_type":{"chat_id":"string","text":"string","message":"object","type":"string"},"user_id":76110,"convTitle":"Send API","chTime":1554800710788,"group":""},{"type":"go","to_node_id":"61adf4a8513aa03475f7869e","chTime":1514361934093}],"semaphors":[]},"title":"Facebook","description":"","x":988,"y":936,"uuid":"1e3999df-faf7-49aa-b960-eef390a81b0d","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a882ba9651b2f9033e","obj_type":0,"condition":{"logics":[{"conditions":[{"fun":"eq","const":"viber","param":"channel","cast":"string"}],"to_node_id":"61adf4a782ba9651b2f9011d","chTime":1561039534443,"type":"go_if_const"},{"node_title":"Telegram","conditions":[{"fun":"eq","const":"telegram","param":"channel","cast":"string"}],"to_node_id":"61adf4a7513aa03475f7846a","type":"go_if_const","data":[{"fun":"eq","const":"telegram","param":"channel","cast":"string"}]},{"node_title":"","conditions":[{"fun":"eq","const":"facebook","param":"channel","cast":"string"}],"to_node_id":"61adf4a882ba9651b2f9039e","type":"go_if_const","data":[{"fun":"eq","const":"facebook","param":"channel","cast":"string"}]},{"type":"go_if_const","conditions":[{"param":"channel","const":"abc","fun":"eq","cast":"string"}],"to_node_id":"61adf4a882ba9651b2f9033f","chTime":1564754139491},{"node_title":"Undefined channel","to_node_id":"61adf4a782ba9651b2f90289","type":"go"}],"semaphors":[]},"title":"Channel?","description":"","x":72,"y":616,"uuid":"48cf7c8e-ef7e-4eeb-b2cd-6ab5536edbce","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a882ba9651b2f903f2","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"language":"{{conv[1012054].ref[{{channel}}_{{chat_id}}].language}}"},"err_node_id":"61adf4a782ba9651b2f9010c","extra_type":{"language":"string"},"chTime":1518597566690},{"type":"go","to_node_id":"61adf4a7513aa03475f7847a","chTime":1566570013165}],"semaphors":[]},"title":"GET language & subscription status","description":"","x":-392,"y":-1068,"uuid":"e2f8c6d5-bb26-4ba9-8bd2-ab57cc2263e7","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f785e4","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a782ba9651b2f9010d","type":"go_if_const","conditions":[{"param":"items","const":"","fun":"eq","cast":"string"},{"param":"buttons","const":"","fun":"eq","cast":"string"}],"chTime":1523863927269},{"type":"go","to_node_id":"61adf4a7513aa03475f7846b","chTime":1537370929442}],"semaphors":[]},"title":"","description":"","x":408,"y":-44,"uuid":"e5d0c6b9-c2ae-4d9e-bacf-e5dc58510441","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f78728","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"localization":"{{conv[1012002].ref[localization]}}"},"err_node_id":"61adf4a782ba9651b2f90282","extra_type":{"localization":"object"},"chTime":1513152158373},{"type":"go","to_node_id":"61adf4a7513aa03475f78470","chTime":1518532470660}],"semaphors":[]},"title":"GET localization","description":"","x":72,"y":-708,"uuid":"5e214b43-84cd-4c23-898f-2a64a6ac12ec","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90284","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f7846e","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f7846f","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f7846f"}],"semaphors":[]},"title":"","description":"","x":720,"y":1156,"uuid":"c569cd3e-0f8a-4a86-83d6-875176ecf5ca","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7846d","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a8513aa03475f7869a","type":"go_if_const","conditions":[{"param":"attachment","const":"","fun":"eq","cast":"string"}],"chTime":1516352006895},{"type":"go","to_node_id":"61adf4a782ba9651b2f9010d","chTime":1523863925599}],"semaphors":[]},"title":"","description":"","x":72,"y":-44,"uuid":"8ec7a52d-bfdb-4a48-ac7f-6ad6384d94b2","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a882ba9651b2f9033f","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a782ba9651b2f90284","src":"if (data.attachment.items) {\n    data.attachment.list_picker = {\n        \"sections\": [\n            {\n            \t\"items\": data.attachment.items,\n\t\t        \"order\": data.attachment.order,\n    \t\t    \"title\": data.attachment.title,\n                \"multipleSelection\": data.attachment.multipleSelection\n            },\n            {\n                \"items\": data.attachment.buttons,\n                \"order\": 1,\n                \"title\": data.attachment.buttonsTitle\n            }\n\t\t],\n        \"receivedMessage\": data.attachment.receivedMessage,\n        \"replyMessage\": data.attachment.replyMessage\n    };\n}\n\nswitch (data.attachment.type) {\n    case \"image\":\n        data.image = data.attachment;\n//         data.attachment = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"file\":\n        data.image = {};\n//         data.attachment = data.attachment;\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n//         delete data.attachment.type;\n        break;\n    case \"text_list_picker\":\n    case \"image_list_picker\":\n        data.image = {};\n        data.list_picker = data.attachment.list_picker;\n        data.images = data.attachment.images || [];\n        data.data_ref = {};\n        data.time_picker = {};\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"data_picker\":\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = data.attachment.data_ref;\n        data.time_picker = {};\n        data.images = [];\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"time_picker\":\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = data.attachment.time_picker;\n        data.images = [];\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"rich_link\":\n        data.rich_link = data.attachment.rich_link;\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.apple_pay_request = {};\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"apple_pay_request\":\n        data.apple_pay_request = data.attachment.apple_pay_request;\n        data.rich_link = {};\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.secret_key = \"\";\n        data.scope = [];\n        break;\n    case \"app_extension_call\":\n        data.apple_pay_request = {};\n        data.rich_link = {};\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.secret_key = \"\";\n        data.scope = [];\n        break;        \n    default:\n        data.attachment.type = \"text\";\n        data.image = {};\n        data.list_picker = {};\n        data.data_ref = {};\n        data.time_picker = {};\n        data.images = [];\n        data.rich_link = {};\n        data.apple_pay_request = {};\n        break;\n}\n\nif (!data.scope) {\n    data.scope = [];\n}\nif (!data.secret_key) {\n    data.secret_key = \"\";\n}\n\nif (data.type == \"oauth_request\") {\n    data.attachment.type = \"oauth_request\";\n}\n","lang":"js"},{"type":"go","to_node_id":"61adf4a782ba9651b2f9011b","chTime":1564754137355}],"semaphors":[]},"title":"ABC Native Syntax","description":"","x":496,"y":1080,"uuid":"d343dde5-2222-4381-90f2-56ae0b0748a2","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f786f9","obj_type":0,"condition":{"logics":[{"type":"api_rpc_reply","res_data":{"result":"error","error_code":"{{error_code}}","error_message":"{{error_message}}"},"res_data_type":{"result":"string","error_code":"string","error_message":"string"},"mode":"key_value","throw_exception":false},{"type":"go","to_node_id":"61adf4a782ba9651b2f90117","chTime":1514361750308}],"semaphors":[]},"title":"Error","description":"","x":1892,"y":836,"uuid":"57ebb642-e333-4ddb-b227-12ac38a8ae47","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a8513aa03475f7869e","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a8513aa03475f786f9","type":"go_if_const","conditions":[{"param":"status","const":"error","fun":"eq","cast":"string"}],"chTime":1514361722274},{"type":"go","to_node_id":"61adf4a7513aa03475f785e7","chTime":1514361768483}],"semaphors":[]},"title":"","description":"","x":1588,"y":788,"uuid":"f5db59d4-703e-4f0c-b8dd-f240fe34b306","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f9011d","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a7513aa03475f78472","src":"if (data.attachment.raw) {\n    for (var key in data.attachment)\n        data[key] = data.attachment[key];\n    if (!data.rich_media) data.rich_media = {};\n    if (!data.keyboard) data.keyboard = {};\n} else GetViberAttachment(data.attachment);\n\nfunction GetViberAttachment(obj) {\n    switch (obj.type) {\n        case \"keyboard\":\n            data.keyboard = {\n                \"Type\": \"keyboard\",\n                \"Buttons\": data.attachment.buttons\n            };\n            if (data.attachment.inputFieldState) data.keyboard.InputFieldState = data.attachment.inputFieldState;\n            data.rich_media = {};\n            break;\n        case \"carousel\":\n            data.rich_media = {\n                \"Type\": \"rich_media\",\n                \"ButtonsGroupColumns\": data.attachment.carouselColumns,\n                \"ButtonsGroupRows\": data.attachment.carouselRows,\n                \"BgColor\": \"#FFFFFF\",\n                \"Buttons\": data.attachment.items\n            };\n            if (data.attachment.buttons && data.attachment.buttons.length > 0) {\n                data.keyboard = {\n                    \"Type\": \"keyboard\",\n                    \"Buttons\": data.attachment.buttons\n                };\n                data.attachment.type = \"carousel_with_keyboard\";\n            } else data.keyboard = {};\n            break;\n        case \"carousel_with_keyboard\":\n            data.rich_media = {\n                \"Type\": \"rich_media\",\n                \"ButtonsGroupColumns\": data.attachment.carouselColumns,\n                \"ButtonsGroupRows\": data.attachment.carouselRows,\n                \"BgColor\": \"#FFFFFF\",\n                \"Buttons\": data.attachment.items\n            };\n            data.keyboard = {\n                \"Type\": \"keyboard\",\n                \"Buttons\": data.attachment.buttons\n            };\n            if (data.attachment.inputFieldState) data.keyboard.InputFieldState = data.attachment.inputFieldState;\n            break;\n        case \"image\":\n            data.media = data.attachment.url;\n            data.rich_media = {};\n            data.keyboard = {};\n            break;\n        case \"video\":\n            data.media = data.attachment.url;\n            data.size = data.attachment.size;\n            data.rich_media = {};\n            data.keyboard = {};\n            break;\n        case \"audio\":\n        case \"file\":\n            data.media = data.attachment.url;\n            data.size = data.attachment.size;\n            data.file_name = data.attachment.name;\n            data.rich_media = {};\n            data.keyboard = {};\n            break;\n        case \"location\":\n            data.lat = attachment.lat;\n            data.lon = attachment.lon;\n            data.rich_media = {};\n            data.keyboard = {};\n            break;\n        default:\n            data.rich_media = {};\n            data.keyboard = {};\n            break;\n    }\n}","lang":"js"},{"type":"go","to_node_id":"61adf4a7513aa03475f785eb","chTime":1543497353641}],"semaphors":[]},"title":"Viber Native Syntax","description":"","x":500,"y":556,"uuid":"2d6bcede-279c-4aac-bb64-0c67e9cf7a3e","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a882ba9651b2f90340","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a8513aa03475f7873e","conditions":[{"fun":"eq","const":"crash_api","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a8513aa03475f7873e","conditions":[{"fun":"eq","const":"rpc_task_fatal_error","param":"__conveyor_rpc_return_type_tag__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f785ea","conditions":[{"fun":"eq","const":"access_denied","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f785ea","conditions":[{"fun":"eq","const":"rpc_reply_exception","param":"__conveyor_rpc_reply_return_type_tag__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f785ea"}],"semaphors":[]},"title":"","description":"","x":1212,"y":1016,"uuid":"006d73e1-99bb-4b74-92b5-0eadfeda53c2","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7846b","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a782ba9651b2f90110","src":"var re = /{{(\\w+\\.?)+}}/ig;\nvar channel = data.channel;\nvar attachment = data.attachment;\nvar items = [];\nvar itemOptions = [];\nvar buttons = [];\nvar itemsPattern = attachment.items;\nvar buttonsPattern = attachment.buttons;\nif (attachment.apple_pay_request) {\n    var paymentItemsPattern = attachment.apple_pay_request.payment.paymentRequest.lineItems;\n}\n\n\n// PAGINATION\nvar totalPages = 0;\nvar maxItemsCountToShow = 0;\nvar currentPage = parseInt(data.currentPage) || 0;\nvar currentOffset = 0;\n\nif (!data.attachment.buttons) {\n    data.attachment.buttons = [];\n}\n\n\n// Get max. items count to render\nif (!data.attachment.maxItemsCountToShow && !data.maxItemsCountToShow) {\n    switch (channel) {\n        case \"facebook\":\n            if (attachment.type === \"carousel\" || attachment.type === \"carousel_with_keyboard\") {\n                maxItemsCountToShow = 10;\n            }\n            if (attachment.type === \"quick_replies\") {\n                maxItemsCountToShow = 6;\n            }\n            if (attachment.type === \"list\") {\n                maxItemsCountToShow = 4;\n            }\n            break;\n        case \"viber\":\n            if (attachment.type === \"carousel\" || attachment.type === \"carousel_with_keyboard\") {\n                maxItemsCountToShow = 6;\n            }\n            if (attachment.type === \"keyboard\") {\n                maxItemsCountToShow = 8;\n            }\n            break;\n        case \"telegram\":\n            if (attachment.type === \"inline_keyboard\") {\n                maxItemsCountToShow = 5;\n            } else {\n                maxItemsCountToShow = 10;\n            }\n            break;\n        case \"abc\":\n            if (attachment.type === \"apple_pay_request\") {\n                maxItemsCountToShow = 10;\n            }\n    }\n} else {\n    maxItemsCountToShow = parseInt(data.attachment.maxItemsCountToShow) || parseInt(data.maxItemsCountToShow);\n}\n\n// Increment page controller\nif (currentPage !== 0) {\n    currentOffset = maxItemsCountToShow * currentPage;\n} else {\n    currentOffset = maxItemsCountToShow;\n}\n\n\n// Get total pages\ntotalPages = Math.ceil(data.items.length / maxItemsCountToShow);\n\n// Slice array by pagination offset\nitemOptions = data.items.slice(currentOffset - maxItemsCountToShow, currentOffset);\n\n// Create Apple Pay dynamic items\nif (attachment.type === \"apple_pay_request\") {\n    createDynamicAttachment(items, data.items, paymentItemsPattern, re);\n    data.attachment.apple_pay_request.payment.paymentRequest.lineItems = items;\n}\n\n// Create dynamic carousel\nif (attachment.items && data.items) {\n    if (attachment.type == \"image_list_picker\") {\n        var images = [];\n        var imagesPattern = attachment.images;\n\t    createDynamicAttachment(images, itemOptions, imagesPattern, re);\n        data.attachment.images = images;\n    }\n    createDynamicAttachment(items, itemOptions, itemsPattern, re);\n    data.attachment.items = items;\n}\n\nif (attachment.type === \"keyboard\" || attachment.type === \"quick_replies\" || attachment.type === \"inline_keyboard\") {\n    data.buttons = itemOptions;\n}\n// Create dynamic keyboard\nif (attachment.buttons && data.buttons) {\n    createDynamicAttachment(buttons, data.buttons, buttonsPattern, re);\n    data.attachment.buttons = buttons;\n}\n\ndata.totalPages = totalPages;\n\n// Create pagination buttons\nif (totalPages > 1) {\n    var paginationButtons = createPaginationButtons(currentPage, totalPages, channel);\n    paginationButtons.forEach(function(button) {\n        if (channel === 'abc') {\n            //             data.attachment.items.push(button);\n            data.attachment.buttons.push(button);\n        } else {\n            if (attachment.type === \"keyboard\" || attachment.type === \"quick_replies\" || attachment.type === \"inline_keyboard\") {\n                data.attachment.buttons.push(button);\n            } else {\n                data.attachment.buttons.unshift(button);\n            }\n        }\n    });\n}\n\nfunction createPaginationButtons(currentPage, totalPages, channel) {\n    var r = [];\n\n    var emptyViberButton = {\n        \"Columns\": \"2\",\n        \"Rows\": 1,\n        \"BgColor\": \"#F3F3F3\",\n        \"Text\": \"\",\n        \"ActionType\": \"reply\",\n        \"ActionBody\": \"none\",\n        \"TextVAlign\": \"middle\",\n        \"TextHAlign\": \"center\",\n        \"TextSize\": \"regular\",\n        \"Silent\": true\n    };\n\n    var paginationPatterns = {\n        \"viber\": [{\n                \"Columns\": \"2\",\n                \"Rows\": 1,\n                \"BgColor\": \"#F3F3F3\",\n                \"Text\": \"{{t'prev}}\",\n                \"ActionType\": \"reply\",\n                \"ActionBody\": \"prev\",\n                \"TextVAlign\": \"middle\",\n                \"TextHAlign\": \"center\",\n                \"TextSize\": \"regular\",\n                \"Silent\": true\n            },\n            {\n                \"Columns\": \"2\",\n                \"Rows\": 1,\n                \"BgColor\": \"#F3F3F3\",\n                \"Text\": currentPage + \" {{t'of}} \" + totalPages,\n                \"ActionType\": \"reply\",\n                \"ActionBody\": \"none\",\n                \"TextVAlign\": \"middle\",\n                \"TextHAlign\": \"center\",\n                \"TextSize\": \"regular\",\n                \"Silent\": true\n            },\n            {\n                \"Columns\": \"2\",\n                \"Rows\": 1,\n                \"BgColor\": \"#F3F3F3\",\n                \"Text\": \"{{t'next}}\",\n                \"ActionType\": \"reply\",\n                \"ActionBody\": \"next\",\n                \"TextVAlign\": \"middle\",\n                \"TextHAlign\": \"center\",\n                \"TextSize\": \"regular\",\n                \"Silent\": true\n            }\n        ],\n        \"facebook\": [{\n                \"content_type\": \"text\",\n                \"title\": \"{{t'prev}}\",\n                \"payload\": \"prev\"\n            },\n            {\n                \"content_type\": \"text\",\n                \"title\": currentPage + \" {{t'of}} \" + totalPages,\n                \"payload\": \"none\"\n            },\n            {\n                \"content_type\": \"text\",\n                \"title\": \"{{t'next}}\",\n                \"payload\": \"next\"\n            }\n        ],\n        \"telegram\": [\n            [{\n                    \"text\": \"{{t'prev}}\",\n                    \"callback_data\": \"prev\"\n                },\n                {\n                    \"text\": currentPage + \" {{t'of}} \" + totalPages,\n                    \"callback_data\": \"none\"\n                },\n                {\n                    \"text\": \"{{t'next}}\",\n                    \"callback_data\": \"next\"\n                }\n            ]\n        ],\n        \"abc\": [{\n                \"identifier\": \"prev\",\n                \"order\": currentOffset + 1,\n                \"style\": \"small\",\n                \"subtitle\": \"\",\n                \"title\": \"{{t'prevPage}}\"\n            },\n            //             {\n            //                 \"identifier\": \"pagination\",\n            //                 \"order\": currentOffset+2,\n            //                 \"style\": \"small\",\n            //                 \"subtitle\": \"\",\n            //                 \"title\": \"{{t'page}}: \" + currentPage + \" {{t'of}} \" + totalPages\n            //             },\n            {\n                \"identifier\": \"next\",\n                \"order\": currentOffset + 3,\n                \"style\": \"small\",\n                \"subtitle\": \"\",\n                \"title\": \"{{t'nextPage}}\"\n            }\n        ]\n    };\n\n    // Iterate through the buttons\n    paginationPatterns[channel].forEach(function(item, i) {\n        if (channel === \"viber\") {\n            // Hide \"Prev\" button at the first page\n            if (i === 0 && currentPage === 1) {\n                item = emptyViberButton;\n            }\n            // Hide \"Next\" button at the last page\n            if (i === 2 && currentPage === totalPages) {\n                item = emptyViberButton;\n            }\n        }\n        if (channel === \"facebook\") {\n            // Hide \"Prev\" button at the first page \n            if (i === 0 && currentPage === 1) {\n                item = \"\";\n            }\n            // Hide \"Next\" button at the last page\n            if (i === 2 && currentPage === totalPages) {\n                item = \"\";\n            }\n        }\n        if (channel === \"abc\") {\n            // Hide \"Prev\" button at the first page \n            if (i === 0 && currentPage === 1) {\n                item = \"\";\n            }\n            // Hide \"Next\" button at the last page\n            if (i === 1 && currentPage === totalPages) {\n                item = \"\";\n            }\n        }\n        if (channel === \"telegram\") {\n            // Hide \"Prev\" button at the first page \n            if (i === 0 && currentPage === 1) {\n                item[0].text = \"-\";\n                item[0].callback_data = \"-\";\n            }\n            // Hide \"Next\" button at the last page\n            if (currentPage === totalPages) {\n                item[2].text = \"-\";\n                item[2].callback_data = \"-\";\n            }\n        }\n\n        if (item) {\n            if (attachment.type === \"quick_replies\" || attachment.type === \"keyboard\" || attachment.type === \"inline_keyboard\") {\n                r.push(item);\n            } else {\n                r.unshift(item);\n            }\n        }\n    });\n\n    return r;\n}\n\nfunction createDynamicAttachment(target, source, patterns, re) {\n    source.forEach(function(item, i, l) {\n\n        // Viber Keyboard\n        item.buttonColumns = 3;\n        // Create rows with 2 buttons\n        if (l.length <= 5 || l.length % 2 === 0 && l.length < 8) {\n            item.buttonColumns = 3;\n        }\n        // Create rows with 3 buttons\n        if (l.length % 3 === 0) {\n            item.buttonColumns = 2;\n        }\n        // Set last button width to 100%\n        // if there are 5 or 7 buttons\n        if (l.length > 4 && l.length < 8) {\n            if (l.length % 3 === 1 || l.length % 2 === 1) {\n                if (i === l.length - 1) {\n                    item.buttonColumns = 6;\n                }\n            }\n        }\n        // Set last buttons width to 50%\n        // if there are 8 buttons\n        if (l.length == 8) {\n            if (i >= 6) {\n                item.buttonColumns = 3;\n            }\n        }\n\n        if (l.length === 1) {\n            item.buttonColumns = 6;\n        }\n\n        if (i < maxItemsCountToShow) {\n            patterns.forEach(function(pattern) {\n                var p = {};\n                if (Array.isArray(pattern)) {\n                    p = deepCopy(pattern);\n                } else {\n                    p = deepCopy(pattern);\n                }\n                replaceVariables(p, item, re);\n                target.push(p);\n            });\n        }\n    });\n}\n\nfunction deepCopy(o) {\n    return JSON.parse(JSON.stringify(o));\n}\n\nfunction replaceVariables(objectToReplace, dataSource, regExp) {\n    if (typeof objectToReplace === \"string\") {\n        return matchToReplace(objectToReplace, dataSource, regExp);\n    } else {\n        for (var k in objectToReplace) {\n            var s = getValueByKey(k, objectToReplace);\n            if (typeof s === 'object') {\n                s = replaceVariables(s, dataSource, regExp);\n            }\n            if (typeof s === \"string\") {\n                objectToReplace[k] = matchToReplace(s, dataSource, regExp);\n            }\n        }\n    }\n}\n\nfunction getValueByKey(key, object) {\n    if (object.hasOwnProperty(key)) {\n        return object[key];\n    }\n}\n\nfunction matchToReplace(stringToReplace, dataSource, regExp) {\n    if (typeof stringToReplace === 'string') {\n        var d = stringToReplace.match(regExp);\n        if (d !== null && d !== undefined && d[0] !== \"\") {\n            for (var i = 0; i < d.length; i++) {\n\n                v = d[i].replace(/{{/, \"\").replace(/}}/, \"\");\n                if (v !== undefined) {\n                    var arrayOfKeys = v.split(\".\");\n                    if (arrayOfKeys.length > 1) {\n                        var o = dataSource;\n                        for (var k in arrayOfKeys) {\n                            var s = arrayOfKeys[k];\n                            o = o[s];\n                            if (typeof o === \"string\" || typeof o === \"number\") {\n                                stringToReplace = stringToReplace.replace(d[i], o);\n                            }\n\n                        }\n                    } else {\n                        if (dataSource[v] !== undefined) {\n                            stringToReplace = stringToReplace.replace(d[i], dataSource[v]);\n                        }\n                    }\n                }\n            }\n\n        }\n    }\n    return stringToReplace;\n}\n\nvar exitButton = {\n    \"viber\": {\n        \"Columns\": \"6\",\n        \"Rows\": 1,\n        \"BgColor\": \"#F3F3F3\",\n        \"Text\": \"ðŸšª {{t'/exit}}\",\n        \"ActionType\": \"reply\",\n        \"ActionBody\": \"/exit\",\n        \"TextVAlign\": \"middle\",\n        \"TextHAlign\": \"center\",\n        \"TextSize\": \"regular\",\n        \"Silent\": true\n    },\n    \"facebook\": {\n        \"content_type\": \"text\",\n        \"title\": \"ðŸšª {{t'/exit}}\",\n        \"payload\": \"/exit\"\n    },\n    \"abc\": {\n        \"identifier\": \"/exit\",\n        \"order\": currentOffset + 4,\n        \"style\": \"default\",\n        \"subtitle\": \"\",\n        \"title\": \"ðŸšª {{t'/exit}}\"\n    },\n    \"telegram\": [{\n        \"text\": \"ðŸšª {{t'/exit}}\",\n        \"callback_data\": \"/exit\"\n    }]\n};\n\nif (!data.disableExitButton) {\n    if (channel === 'abc') {\n        // \t\tdata.attachment.items.push(exitButton[channel]);   \n        // \t\tdata.attachment.buttonsTitle = \"{{t'buttons}}\";\n        if (totalPages > 1) {\n\t        data.attachment.buttonsTitle = \"{{t'page}}: \" + currentPage + \" {{t'of}} \" + totalPages;\n        }\n        data.attachment.buttons.push(exitButton[channel]);\n    } else {\n        data.attachment.buttons.push(exitButton[channel]);\n    }\n\n}","lang":"js"},{"type":"go","to_node_id":"61adf4a782ba9651b2f9010d","chTime":1561640117428}],"semaphors":[]},"title":"createDynamicAttachment","description":"","x":408,"y":176,"uuid":"7bdaa030-f43b-406e-bf00-d08424b8f7a1","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f9010d","obj_type":0,"condition":{"logics":[{"type":"api_code","err_node_id":"61adf4a782ba9651b2f90114","src":"var re = /{{\\w+}}/ig;\nvar reLocale = /{{t'.\\w+}}/ig;\nvar mode = \"variables\";\n\n// Apple Business Chat | App Extension Call\nfunction uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0,\n            v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\ndata.uuid = uuidv4();\n\ndelete data.attachment_object;\n\n// Replace text variables\ndata.text = replaceVariables(data.text, data, re);\nmode = \"localize\";\ndata.text = replaceVariables(data.text, data.localization, reLocale);\nmode = \"variables\";\t\n\n// Localize attachment and replace variables\nif (data.attachment && data.attachment !== {}) {\n    replaceVariables(data.attachment, data, re);\n    mode = \"localize\";\n    replaceVariables(data.attachment, data.localization, reLocale);\n    mode = \"variables\";\n    replaceVariables(data.attachment, data, re);\n    mode = \"localize\";\n}\n\n\nfunction replaceVariables(objectToReplace, dataSourceToReplace, regExp) {\n    if (typeof objectToReplace === \"string\") {\n        return matchToReplace(objectToReplace, dataSourceToReplace, regExp);\n    } else {\n        for (var k in objectToReplace) {\n            var s = getValueByKey(k, objectToReplace);\n            if (typeof s === 'object') {\n                s = replaceVariables(s, dataSourceToReplace, regExp);\n            }\n            if (typeof s === \"string\") {\n                objectToReplace[k] = matchToReplace(s, dataSourceToReplace, regExp);\n            }\n        }\n    }\n}\n\nfunction getValueByKey(key, object) {\n    if (object.hasOwnProperty(key)) {\n        return object[key];\n    }\n}\n\nfunction matchToReplace(stringToReplace, dataSource, regExp) {\n    if (typeof stringToReplace === 'string') {\n        var d = stringToReplace.match(regExp);\n        if (d !== null && d !== undefined && d[0] !== \"\") {\n            for (var i = 0; i < d.length; i++) {\n                // Localization\n                if (mode == \"localize\") {\n                    v = d[i].replace(/{{t'/, \"\").replace(/}}/, \"\");\n                    if (v !== undefined) {\n                       if (dataSource[v] !== undefined) {\n                           stringToReplace = stringToReplace.replace(d[i], dataSource[v][data.language]);\n                        }\n                    }\n                    \n                // Variables\n               } else {\n                    v = d[i].replace(/{{/, \"\").replace(/}}/, \"\");\n                    if (v !== undefined) {\n                        var arrayOfKeys = v.split(\".\");\n                        if (arrayOfKeys.length > 1) {\n                            var o = dataSource;\n                            for (var k in arrayOfKeys) {\n                                var s = arrayOfKeys[k];\n                                o = o[s];\n                                if (typeof o === \"string\") {\n                                    stringToReplace = stringToReplace.replace(d[i], o);\n                                }\n\n                            }\n                        } else {\n                            if (dataSource[v] !== undefined) {\n                                stringToReplace = stringToReplace.replace(d[i], dataSource[v]);\n                            }\n                        }\n                    }\n               }\n                \n            }\n        }\n    }\n    return stringToReplace;\n}","lang":"js"},{"type":"go","to_node_id":"61adf4a882ba9651b2f9033e","chTime":1523862679424}],"semaphors":[]},"title":"Replace variables in text/attachment","description":"","x":72,"y":400,"uuid":"922f0d60-177b-4ed4-8970-1c993ada8e6d","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90114","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a8513aa03475f7869f","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90119","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a782ba9651b2f90119"}],"semaphors":[]},"title":"","description":"","x":292,"y":476,"uuid":"0b77a275-0e49-4a22-bb98-a381e30738fd","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78473","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f785e8","conditions":[{"fun":"eq","const":"crash_api","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f785e8","conditions":[{"fun":"eq","const":"rpc_task_fatal_error","param":"__conveyor_rpc_return_type_tag__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78474","conditions":[{"fun":"eq","const":"access_denied","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78474","conditions":[{"fun":"eq","const":"rpc_reply_exception","param":"__conveyor_rpc_reply_return_type_tag__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f78474"}],"semaphors":[]},"title":"","description":"","x":1212,"y":664,"uuid":"9dcfee58-8172-4669-b6e9-0a258b139b70","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78470","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a782ba9651b2f90285","type":"go_if_const","conditions":[{"param":"text_id","const":"","fun":"not_eq","cast":"string"}],"chTime":1513868168499},{"type":"go","to_node_id":"61adf4a8513aa03475f7869b","chTime":1488875041990}],"semaphors":[]},"title":"Check text_id","description":"","x":72,"y":-524,"uuid":"b8b1b083-35ad-4cc9-81ed-9a711d8fb349","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90113","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90288","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78476","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f78476"}],"semaphors":[]},"title":"","description":"","x":720,"y":804,"uuid":"127ea5fa-fbeb-47cc-99bf-0e3b7caa95b1","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f90115","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78479","conditions":[{"fun":"eq","const":"crash_api","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78479","conditions":[{"fun":"eq","const":"rpc_task_fatal_error","param":"__conveyor_rpc_return_type_tag__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90116","conditions":[{"fun":"eq","const":"access_denied","param":"__conveyor_copy_task_result__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a782ba9651b2f90116","conditions":[{"fun":"eq","const":"rpc_reply_exception","param":"__conveyor_rpc_reply_return_type_tag__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a782ba9651b2f90116"}],"semaphors":[]},"title":"","description":"","x":1212,"y":840,"uuid":"ef3ff02c-de9f-4abb-9caf-bcfb3b62a128","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a782ba9651b2f9011b","obj_type":0,"condition":{"logics":[{"type":"api_rpc","err_node_id":"61adf4a7513aa03475f785e5","extra":{"chat_id":"{{chat_id}}","type":"{{attachment.type}}","image":"{{image}}","list_picker":"{{list_picker}}","data_ref":"{{data_ref}}","time_picker":"{{time_picker}}","text":"{{text}}","images":"{{images}}","rich_link":"{{rich_link}}","apple_pay_request":"{{apple_pay_request}}","attachment":"{{attachment}}","secret_key":"{{secret_key}}","scope":"{{scope}}"},"extra_type":{"chat_id":"string","type":"string","image":"object","list_picker":"object","data_ref":"object","time_picker":"object","text":"string","images":"array","rich_link":"object","apple_pay_request":"object","attachment":"object","secret_key":"string","scope":"array"},"group":"","conv_id":1012056,"user_id":76110},{"type":"go","to_node_id":"61adf4a8513aa03475f7869e","chTime":1561126286645}],"semaphors":[]},"title":"Apple Business Chat","description":"","x":988,"y":1112,"uuid":"2edb1848-3b0c-4d9d-9d25-11d67262e8d2","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7846c","obj_type":0,"condition":{"logics":[{"type":"set_param","extra":{"attachment":"{{conv[1012029].ref[{{attachment_id}}].{{channel}}}}"},"err_node_id":"61adf4a882ba9651b2f90341","extra_type":{"attachment":"object"},"chTime":1513152158373},{"type":"go","to_node_id":"61adf4a7513aa03475f785e4","chTime":1563349141711}],"semaphors":[]},"title":"GET attachment from State Diagram","description":"","x":408,"y":-260,"uuid":"4f976161-ba30-4974-adc1-05b881785b81","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f78472","obj_type":3,"condition":{"logics":[{"type":"go_if_const","to_node_id":"61adf4a882ba9651b2f9039d","conditions":[{"fun":"eq","const":"hardware","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go_if_const","to_node_id":"61adf4a7513aa03475f78475","conditions":[{"fun":"eq","const":"software","param":"__conveyor_code_return_type_error__","cast":"string"}]},{"type":"go","to_node_id":"61adf4a7513aa03475f78475"}],"semaphors":[]},"title":"","description":"","x":720,"y":632,"uuid":"6e772cb9-0fa2-4ebe-a7d2-4bd8bdb5e30c","extra":"{\"modeForm\":\"collapse\",\"icon\":\"\"}","options":null},{"id":"61adf4a7513aa03475f7847a","obj_type":0,"condition":{"logics":[{"to_node_id":"61adf4a8513aa03475f78728","type":"go_if_const","conditions":[{"param":"language","const":"ru","fun":"eq","cast":"string"}],"chTime":1522680421513},{"type":"go_if_const","conditions":[{"param":"language","const":"uk","fun":"eq","cast":"string"}],"to_node_id":"61adf4a8513aa03475f78728","chTime":1596182127979},{"type":"go_if_const","conditions":[{"param":"language","const":"en","fun":"eq","cast":"string"}],"to_node_id":"61adf4a8513aa03475f78728","chTime":1596182128921},{"type":"go","to_node_id":"61adf4a7513aa03475f785e6","chTime":1596182132688}],"semaphors":[]},"title":"","description":"","x":-392,"y":-860,"uuid":"bdd2fbb1-6c47-49ff-b669-aa0f44a3ae75","extra":"{\"modeForm\":\"expand\",\"icon\":\"\"}","options":null}],"web_settings":[[],[]]},"conv_type":"process","uuid":"08076858-967b-46ed-8894-d701d77105d7"}